<!DOCTYPE html>
<html>
  

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="es_ES" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M146BEZEJV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-M146BEZEJV');
  </script>

  <meta name="description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen.">
  <title>Objective-C and Swift interop using package:ffigen | Dart es Español</title>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/img/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/img/touch-icon-ipad.png" rel="apple-touch-icon" sizes="152x152">
  <link href="/assets/img/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/assets/img/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="167x167">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@dart_lang" />
  <meta name="twitter:title" content="Objective-C and Swift interop using package:ffigen" />
  <meta name="twitter:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen." />

  <!-- Open Graph -->
  <meta property="og:title" content="Objective-C and Swift interop using package:ffigen" />
  <meta property="og:description" content="To use Objective-C and Swift code in your Dart program, use package:ffigen." />
  <meta property="og:url" content="https://dart.esdocu.com/guides/libraries/objective-c-interop" />
  
  <meta property="og:image" content="https://dart.esdocu.com/assets/shared/dart-logo-for-shares.png?2" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Display:wght@400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
  <script 
    src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
    data-auto-replace-svg="nest">
  </script>

  <link rel="stylesheet" href="/assets/css/main.css?v=1662104133">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
          integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"
          integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.1/js/bootstrap.min.js"
          integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2"
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js" 
          integrity="sha512-wT7uPE7tOP6w4o28u1DN775jYjHQApdBnib5Pho4RB0Pgd9y7eSkAV1BTqQydupYDB9GBhTcQQzyNMPMV3cAew==" 
          crossorigin="anonymous" 
          referrerpolicy="no-referrer"></script>

  <script src="/assets/js/vendor/code-prettify/prettify.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-css.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-dart.js"></script>
  <script src="/assets/js/vendor/code-prettify/lang-yaml.js"></script>
  <script src="/assets/js/os-tabs.js?v=1662104133"></script>
  <script src="/assets/js/utilities.js?v=1662104133"></script>
  <script src="/assets/js/main.js?v=1662104133"></script>

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26406144-4', 'auto');
ga('send', 'pageview');

</script>


 </head>

  <body class="default show_banner">
    <section id="cookie-notice">
  <div class="container">
    <p>Google utiliza cookies para prestar sus servicios, personalizar anuncios y analizar el tráfico. 
      Puedes ajustar tus controles de privacidad en cualquier momento en tu 
      <a href="https://myaccount.google.com/data-and-personalization" target="_blank" rel="noopener" class="no-automatic-external">Configuración de Google</a>.
      <a href="https://policies.google.com/technologies/cookies" target="_blank" rel="noopener" class="no-automatic-external">Más información</a>.
    </p>
    <button id="cookie-consent" class="btn btn-primary">Entiendo</button>
  </div>
</section>

    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VSZM5J"
 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header id="page-header" class="site-header">
  <nav id="mainnav" class="site-header">
  <div id="menu-toggle"><i class="material-icons">menu</i></div>
  <a href="/" class="brand" title="Dart es Español">
    <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart es Español">
  </a>
  <ul class="navbar">
    <li>
      <a href="/overview" class="nav-link">Overview</a>
    </li>
    <li class="mainnav__get-started">
      <a href="/guides" class="nav-link
         active">
        <span>Docs</span>
      </a>
    </li>
    <li>
      <a href="/community" class="nav-link">Comunidad</a>
    </li>
    <li>
      <a href="/#try-dart" class="nav-link">Probar Dart</a>
    </li>
    <li>
      <a href="/get-dart" class="nav-link">Obtener Dart</a>
    </li>
    <li class="searchfield">
      <form action="/search" class="site-header__search form-inline" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input class="site-header__searchfield form-control search-field" type="search" name="q"
          id="q" autocomplete="off" placeholder="Search" aria-label="Search">
      </form>
    </li>
  </ul>
</nav>

  
</header>
 <div class="banner">
  <p class="banner__text">
    Dart 2.18 ya está disponible con interoperabilidad de Objective-C y Swift y mejoras de networking, la inferencia de tipos y el rendimiento del código asíncrono. <a href="https://medium.com/@mit.mit/dart-2-18-f4b3101f146c">Más información</a><br>
    Los equipos de Flutter y Dart están contratando.
    <a href="https://docs.flutter.dev/jobs">Más información</a>
  </p>
</div> 

    <div id="sidenav" class="">
  <form action="/search/" class="site-header__search form-inline">
    <input class="site-header__searchfield form-control search-field" type="search" name="q"
           id="q" autocomplete="off" placeholder="Search" aria-label="Search">
  </form>

  <div class="site-sidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a href="/overview" class="nav-link">Overview</a>
      </li>
      <li class="nav-item">
        <a href="/community" class="nav-link">Comunidad</a>
      </li>
      <li class="nav-item">
        <a href="https://dartpad.dev" class="nav-link">Probar Dart</a>
      </li>
      <li class="nav-item">
        <a href="/get-dart" class="nav-link">Obtener Dart</a>
      </li>
      <li class="nav-item">
        <a href="/guides" class="nav-link active">Docs</a>
      </li>
    </ul>

    <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button"
        aria-expanded="false" aria-controls="sidenav-1"
      >Samples & tutorials</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/samples">Language samples</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable"
      data-toggle="collapse" data-target="#sidenav-1-2"
      href="#sidenav-1-2" role="button"
      aria-expanded="true" aria-controls="sidenav-1-2"
    >Codelabs
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/codelabs">List of Dart codelabs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/dart-cheatsheet">Language cheatsheet</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/iterables">Iterable collections</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Asynchronous programming</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/codelabs/null-safety">Null safety</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/tutorials">Tutorials</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button"
        aria-expanded="false" aria-controls="sidenav-2"
      >Language</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="/guides/language/language-tour">Tour</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/type-system">Type system</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-2-3"
      href="#sidenav-2-3" role="button"
      aria-expanded="false" aria-controls="sidenav-2-3"
    >Effective Dart
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-3">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/effective-dart">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/effective-dart/style">Style</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/effective-dart/documentation">Documentation</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/effective-dart/usage">Usage</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/effective-dart/design">Design</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-2-4"
      href="#sidenav-2-4" role="button"
      aria-expanded="false" aria-controls="sidenav-2-4"
    >Coming from ...
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/coming-from/js-to-dart">JavaScript to Dart</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/language/extension-methods">Extension methods</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/concurrency">Concurrency</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/numbers">Numbers</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-2-8"
      href="#sidenav-2-8" role="button"
      aria-expanded="false" aria-controls="sidenav-2-8"
    >Null safety
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2-8">
      <li class="nav-item">
    <a class="nav-link" href="/null-safety">Overview: Sound null safety</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/migration-guide">Migrating to null safety</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/understanding-null-safety">Understanding null safety</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/unsound-null-safety">Unsound null safety</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/null-safety/faq">FAQ</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/language/evolution">Evolution</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/spec">Specification</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-3" role="button"
        aria-expanded="false" aria-controls="sidenav-3"
      >Core libraries</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link" href="/guides/libraries">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/library-tour">Tour</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-3-3"
      href="#sidenav-3-3" role="button"
      aria-expanded="false" aria-controls="sidenav-3-3"
    >Articles
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-3">
      <li class="nav-item">
    <a class="nav-link" href="/articles/libraries/dart-io">Intro to dart:io</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/articles/libraries/creating-streams">Creating streams</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button"
        aria-expanded="false" aria-controls="sidenav-4"
      >Packages</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/guides/packages">How to use packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/useful-libraries">Commonly used packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/create-library-packages">Creating packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/publishing">Publishing packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/writing-package-pages">Writing package pages</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-4-6"
      href="#sidenav-4-6" role="button"
      aria-expanded="false" aria-controls="sidenav-4-6"
    >Package reference
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4-6">
      <li class="nav-item">
    <a class="nav-link" href="/tools/pub/dependencies">Dependencies</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/glossary">Glossary</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/package-layout">Package layout conventions</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/environment-variables">Pub environment variables</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/pubspec">Pubspec file</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/troubleshoot">Troubleshooting pub</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/verified-publishers">Verified publishers</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/pub/versioning">Versioning</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link active" data-toggle="collapse" href="#sidenav-5" role="button"
        aria-expanded="true" aria-controls="sidenav-5"
      >Development</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/codelabs/async-await">Futures, async, await</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/language/streams">Streams</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/json">JSON</a>
  </li><li class="nav-item">
    <a class="nav-link active collapsable"
      data-toggle="collapse" data-target="#sidenav-5-4"
      href="#sidenav-5-4" role="button"
      aria-expanded="true" aria-controls="sidenav-5-4"
    >Interoperability
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-5-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/libraries/c-interop">C interop</a>
  </li><li class="nav-item">
    <a class="nav-link active" href="/guides/libraries/objective-c-interop">Objective-C and Swift interop</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/js-interop">JavaScript interop</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/guides/google-apis">Google APIs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/multiplatform-apps">Multi-platform apps</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-5-7"
      href="#sidenav-5-7" role="button"
      aria-expanded="false" aria-controls="sidenav-5-7"
    >Command-line & server apps
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-7">
      <li class="nav-item">
    <a class="nav-link" href="/server">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/get-started">Get started</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/cmdline">Write command-line apps</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/server/httpserver">Write HTTP servers</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/libraries">Libraries and packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/server/google-cloud">Google Cloud</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-5-8"
      href="#sidenav-5-8" role="button"
      aria-expanded="false" aria-controls="sidenav-5-8"
    >Web apps
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-8">
      <li class="nav-item">
    <a class="nav-link" href="/web">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/get-started">Get started</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tutorials/web/fetch-data">Fetch data dynamically</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-5-8-4"
      href="#sidenav-5-8-4" role="button"
      aria-expanded="false" aria-controls="sidenav-5-8-4"
    >Low-level web programming
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5-8-4">
      <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/connect-dart-html">Connect Dart & HTML</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/add-elements">Add elements to the DOM</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tutorials/web/low-level-html/remove-elements">Remove DOM elements</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/web/deployment">Deployment</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/libraries">Libraries and packages</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-6" role="button"
        aria-expanded="false" aria-controls="sidenav-6"
      >Tools & techniques</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/tools">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-6-2"
      href="#sidenav-6-2" role="button"
      aria-expanded="false" aria-controls="sidenav-6-2"
    >Editors & debuggers
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/jetbrains-plugin">IntelliJ & Android Studio</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/vs-code">VS Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dart-devtools">Dart DevTools</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/dartpad">DartPad</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-6-3"
      href="#sidenav-6-3" role="button"
      aria-expanded="false" aria-controls="sidenav-6-3"
    >Command-line tools
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-3">
      <li class="nav-item">
    <a class="nav-link collapsable"
      data-toggle="collapse" data-target="#sidenav-6-3-1"
      href="#sidenav-6-3-1" role="button"
      aria-expanded="true" aria-controls="sidenav-6-3-1"
    >Dart SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/tools/sdk">Overview</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-tool">dart</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-analyze">dart analyze</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-compile">dart compile</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-create">dart create</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-doc">dart doc</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-fix">dart fix</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-format">dart format</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/pub/cmd">dart pub</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-run">dart run</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dart-test">dart test</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/dartaotruntime">dartaotruntime</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/experiment-flags">Experiment flags</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable"
      data-toggle="collapse" data-target="#sidenav-6-3-2"
      href="#sidenav-6-3-2" role="button"
      aria-expanded="true" aria-controls="sidenav-6-3-2"
    >Other command-line tools
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6-3-2">
      <li class="nav-item">
    <a class="nav-link" href="/tools/build_runner">build_runner</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tools/webdev">webdev</a>
  </li>
  </ul>
  </li>
</ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-6-4"
      href="#sidenav-6-4" role="button"
      aria-expanded="false" aria-controls="sidenav-6-4"
    >Managing source code
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-4">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/formatting">Formatting code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/libraries/private-files">What not to commit</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-6-5"
      href="#sidenav-6-5" role="button"
      aria-expanded="false" aria-controls="sidenav-6-5"
    >Static analysis
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-5">
      <li class="nav-item">
    <a class="nav-link" href="/guides/language/analysis-options">Customizing static analysis</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/guides/language/sound-problems">Fixing common type problems</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/diagnostic-messages">Diagnostic messages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/tools/linter-rules">Linter rules</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-6-6"
      href="#sidenav-6-6" role="button"
      aria-expanded="false" aria-controls="sidenav-6-6"
    >Testing & optimization
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-6-6">
      <li class="nav-item">
    <a class="nav-link" href="/guides/testing">Testing</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/web/debugging">Debugging web apps</a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-7" role="button"
        aria-expanded="false" aria-controls="sidenav-7"
      >Resources</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/resources">Overview</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/books">Books</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/resources/dartpad-best-practices">DartPad in tutorials: Best practices</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/code-of-conduct">Code of conduct</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/faq">FAQ</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed"
      data-toggle="collapse" data-target="#sidenav-7-6"
      href="#sidenav-7-6" role="button"
      aria-expanded="false" aria-controls="sidenav-7-6"
    >History
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-7-6">
      <li class="nav-item">
    <a class="nav-link" href="/dart-2">Migrating to Dart&nbsp;2</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/resources/videos">Videos</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-8" role="button"
        aria-expanded="true" aria-controls="sidenav-8"
      >Related sites</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-8">
        <li class="nav-item">
    <a class="nav-link" href="https://api.dart.dev" target="_blank" rel="noopener">API reference<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://medium.com/dartlang" target="_blank" rel="noopener">Blog<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://dartpad.dev" target="_blank" rel="noopener">DartPad (online editor)<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.dev" target="_blank" rel="noopener">Flutter<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.dev" target="_blank" rel="noopener">Package site<span class="material-icons md-24">
        open_in_new
      </span></a>
  </li>
</ul>
    </li></ul>

  </div>
</div>

    <main id="page-content">
      







<div id="site-toc--side" class="site-toc ">
  <header class="site-toc__title">
    Contents
    <button type="button" class="btn site-toc--button__page-top" aria-label="Page top"></button>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#objective-c-example">Objective-C Example</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-ffigen">Configuring ffigen</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-dart-bindings">Generating the Dart bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#using-the-bindings">Using the bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#swift-example">Swift example</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#configuring-ffigen-1">Configuring ffigen</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#using-the-bindings-1">Using the bindings</a></li>
</ul>
</li>
</ul>
</div>


      <article>
        <div class="content">
          

          <div>
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/dart-lang/site-www/tree/main/src/_guides/libraries/objective-c-interop.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="fas fa-file-alt fa-sm"></i>
  </a>
  <a href="https://github.com/dart-lang/site-www/issues/new?template=1_page_issue.yml&title=[PAGE ISSUE]: 'Objective-C and Swift interop using package:ffigen'&page-url=https://dart.esdocu.com/guides/libraries/objective-c-interop&page-source=https://github.com/dart-lang/site-www/tree/main/src/_guides/libraries/objective-c-interop.md" class="btn no-automatic-external" title="Report an issue with this page"
    target="_blank" rel="noopener">
    <i class="fas fa-bug fa-sm"></i>
  </a>
</div>

            <h1>Objective-C and Swift interop using package:ffigen</h1>
          </div>
          







<div id="site-toc--inline" class="site-toc toc-collapsible toc-collapsed">
  <header class="site-toc__title">
    Contents
    <button type="button" class="btn site-toc--button__page-top" aria-label="Page top"></button>
    
      <span class="site-toc--inline__toggle toc-toggle-down"><i class="material-icons">keyboard_arrow_down</i></span>
      <span class="site-toc--inline__toggle toc-toggle-up"><i class="material-icons">keyboard_arrow_up</i></span>
    
  </header>
  <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#objective-c-example">Objective-C Example</a>
<ul>
<li class="toc-entry toc-h3"><a href="#configuring-ffigen">Configuring ffigen</a></li>
<li class="toc-entry toc-h3"><a href="#generating-the-dart-bindings">Generating the Dart bindings</a></li>
<li class="toc-entry toc-h3"><a href="#using-the-bindings">Using the bindings</a></li>
<li class="toc-entry toc-h3"><a href="#callbacks-and-multithreading-limitations">Callbacks and multithreading limitations</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#swift-example">Swift example</a>
<ul>
<li class="toc-entry toc-h3"><a href="#generating-the-objective-c-wrapper-header">Generating the Objective-C wrapper header</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-ffigen-1">Configuring ffigen</a></li>
<li class="toc-entry toc-h3"><a href="#generating-the-dart-bindings-1">Generating the Dart bindings</a></li>
<li class="toc-entry toc-h3"><a href="#using-the-bindings-1">Using the bindings</a></li>
</ul>
</li>
</ul>
</div>


          <p>Dart mobile, command-line, and server apps
running on the <a href="/overview#platform">Dart Native platform</a>, on macOS or iOS,
can use <code class="language-plaintext highlighter-rouge">dart:ffi</code> and <a href="https://pub.dev/packages/ffigen"><code class="language-plaintext highlighter-rouge">package:ffigen</code></a>
to call Objective-C and Swift APIs.</p>

<aside class="alert alert-info" role="alert">
  <p><i class="fas fa-info-circle"></i> <strong>Note:</strong>
  This interop feature is <strong>experimental</strong>,
  and <a href="https://github.com/dart-lang/sdk/issues/49673">in active development</a>.</p>
</aside>

<p><code class="language-plaintext highlighter-rouge">dart:ffi</code> allows Dart code to interact with native C APIs.
Objective-C is based on and compatible with C,
so it is possible to interact with Objective-C APIs using only <code class="language-plaintext highlighter-rouge">dart:ffi</code>.
However, doing so involves a lot of boilerplate code,
so you can use <code class="language-plaintext highlighter-rouge">package:ffigen</code> to automatically generate
the Dart FFI bindings for a given Objective-C API.
To learn more about FFI and interfacing with C code directly,
see the <a href="/guides/libraries/c-interop">C interop guide</a>.</p>

<p>You can generate Objective-C headers for Swift APIs,
allowing <code class="language-plaintext highlighter-rouge">dart:ffi</code> and <code class="language-plaintext highlighter-rouge">package:ffigen</code> to interact with Swift.</p>

<h2 id="objective-c-example">
<a class="anchor" href="#objective-c-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objective-C Example</h2>

<p>This guide walks you through <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c">an example</a>
that uses <code class="language-plaintext highlighter-rouge">package:ffigen</code> to generate bindings for
<a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer?language=objc"><code class="language-plaintext highlighter-rouge">AVAudioPlayer</code></a>.
This API requires at least macOS SDK 10.7,
so check your version and update Xcode if necessary:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>xcodebuild <span class="nt">-showsdks</span>
</code></pre></div></div>

<p>Generating bindings to wrap an Objective-C API is similar to wrapping a C API.
Direct <code class="language-plaintext highlighter-rouge">package:ffigen</code> at the header file that describes the API,
and then load the library with <code class="language-plaintext highlighter-rouge">dart:ffi</code>.</p>

<p><code class="language-plaintext highlighter-rouge">package:ffigen</code> parses Objective-C header files
using <a href="https://llvm.org/">LLVM</a>,
so you’ll need to install that first.
See <a href="https://pub.dev/packages/ffigen#installing-llvm">Installing LLVM</a>
from the ffigen README for more details.</p>

<h3 id="configuring-ffigen">
<a class="anchor" href="#configuring-ffigen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring ffigen</h3>

<p>First, add <code class="language-plaintext highlighter-rouge">package:ffigen</code> as a dev dependency:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart pub add <span class="nt">--dev</span> ffigen
</code></pre></div></div>

<p>Then, configure ffigen to generate bindings for the
Objective-C header containing the API.
The ffigen configuration options go in your <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> file,
under a top-level <code class="language-plaintext highlighter-rouge">ffigen</code> entry.
Alternatively, you can put the ffigen config in its own <code class="language-plaintext highlighter-rouge">.yaml</code> file.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ffigen</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">AVFAudio</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Bindings for AVFAudio.</span>
  <span class="na">language</span><span class="pi">:</span> <span class="s">objc</span>
  <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">avf_audio_bindings.dart'</span>
  <span class="na">headers</span><span class="pi">:</span>
    <span class="na">entry-points</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks/AVFAudio.framework/Headers/AVAudioPlayer.h'</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">name</code> is the name of the native library wrapper class
that will be generated,
and the <code class="language-plaintext highlighter-rouge">description</code> will be used in the documentation for that class.
The <code class="language-plaintext highlighter-rouge">output</code> is the path of the Dart file that ffigen will create.
The entry point is the header file containing the API.
In this example, it is the internal <code class="language-plaintext highlighter-rouge">AVAudioPlayer.h</code> header.</p>

<p>Another import thing you’ll see,
if you look at the <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/pubspec.yaml">example config</a>,
is the exclude and include options.
By default, <code class="language-plaintext highlighter-rouge">ffigen</code> generates bindings for everything
it finds in the header,
and everything that those bindings depend on in other headers.
Most Objective-C libraries depend on Apple’s internal libraries,
which are very large.
If bindings are generated without any filters,
the resulting file can be millions of lines long.
To solve this problem,
the ffigen config has fields that allow you to filter out
all the functions, structs, enums, etc., that you’re not interested in.
For this example, we’re only interested in <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
so you can exclude everything else:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">exclude-all-by-default</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">objc-interfaces</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">AVAudioPlayer'</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code> is explicitly included like this,
<code class="language-plaintext highlighter-rouge">ffigen</code> excludes all other interfaces.
The <code class="language-plaintext highlighter-rouge">exclude-all-by-default</code> flag tells <code class="language-plaintext highlighter-rouge">ffigen</code> to
exclude everything else.
The result is that nothing is included except <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
and its dependencies, such as <code class="language-plaintext highlighter-rouge">NSObject</code> and <code class="language-plaintext highlighter-rouge">NSString</code>.
So instead of several million lines of bindings,
you end up with tens of thousands.</p>

<p>If you need more granular control,
you can exclude or include all declarations individually,
rather than using <code class="language-plaintext highlighter-rouge">exclude-all-by-default</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">functions</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">structs</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">unions</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">globals</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">macros</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">enums</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
  <span class="na">unnamed-enums</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.*'</span>
</code></pre></div></div>

<p>These <code class="language-plaintext highlighter-rouge">exclude</code> entries all exclude the regular expression <code class="language-plaintext highlighter-rouge">'.*'</code>,
which matches anything.</p>

<p>You can also use the <code class="language-plaintext highlighter-rouge">preamble</code> option
to insert text at the top of the generated file.
In this example, the <code class="language-plaintext highlighter-rouge">preamble</code> was used
to insert some linter ignore rules at the top of the generated file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">preamble</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">// ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span>
</code></pre></div></div>

<p>See the <a href="https://pub.dev/packages/ffigen#configurations">ffigen readme</a>
for a full list of configuration options.</p>

<h3 id="generating-the-dart-bindings">
<a class="anchor" href="#generating-the-dart-bindings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Dart bindings</h3>

<p>To generate the bindings, navigate to the example directory,
and run ffigen:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen
</code></pre></div></div>

<p>This will search in the <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> file for a top-level <code class="language-plaintext highlighter-rouge">ffigen</code> entry.
If you chose to put the ffigen config in a separate file, use the
<code class="language-plaintext highlighter-rouge">--config</code> option and specify that file:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen <span class="nt">--config</span> my_ffigen_config.yaml
</code></pre></div></div>

<p>For this example, this will generate
<a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/avf_audio_bindings.dart">avf_audio_bindings.dart</a>.</p>

<p>This file contains a class called <code class="language-plaintext highlighter-rouge">AVFAudio</code>, which is the native library
wrapper that loads all the API functions using FFI,
and provides convenient wrapper methods to call them.
The other classes in this file are all Dart wrappers
around the Objective-C interfaces that we need,
such as <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code> and its dependencies.</p>

<h3 id="using-the-bindings">
<a class="anchor" href="#using-the-bindings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the bindings</h3>

<p>Now you’re ready to load and interact with the generated library.
The example app, <a href="https://github.com/dart-lang/ffigen/tree/master/example/objective_c/play_audio.dart">play_audio.dart</a>,
loads and plays audio files passed as command line arguments.
The first step is to load the
<a href="https://developer.apple.com/documentation/avfaudio?language=objc">dylib</a>
and instantiate the native <code class="language-plaintext highlighter-rouge">AVFAudio</code> library:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'dart:ffi'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'avf_audio_bindings.dart'</span><span class="o">;</span>

<span class="kd">const</span> <span class="n">_dylibPath</span> <span class="o">=</span>
    <span class="s">'/System/Library/Frameworks/AVFAudio.framework/Versions/Current/AVFAudio'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="n">args</span><span class="o">)</span> <span class="kd">async</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">AVFAudio</span><span class="o">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">_dylibPath</span><span class="o">));</span>
</code></pre></div></div>

<p>Since you’re loading an internal library,
the dylib path is pointing at an internal framework dylib.
You can also load your own <code class="language-plaintext highlighter-rouge">.dylib</code> file,
or if the library is statically linked into your app (often the case on iOS)
you can use <a href="https://api.dart.dev/dart-ffi/DynamicLibrary/DynamicLibrary.process.html"><code class="language-plaintext highlighter-rouge">DynamicLibrary.process()</code></a>:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">AVFAudio</span><span class="o">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">process</span><span class="o">());</span>
</code></pre></div></div>

<p>The goal of the example is to play each of the audio files
specified as command line arguments one by one.
For each argument,
you first have to convert the Dart <code class="language-plaintext highlighter-rouge">String</code> to an Objective-C <code class="language-plaintext highlighter-rouge">NSString</code>.
The generated <code class="language-plaintext highlighter-rouge">NSString</code> wrapper has a convenient constructor
that handles this conversion,
and a <code class="language-plaintext highlighter-rouge">toString()</code> method that converts it back to a Dart <code class="language-plaintext highlighter-rouge">String</code>.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">file</span> <span class="k">in</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">fileStr</span> <span class="o">=</span> <span class="n">NSString</span><span class="o">(</span><span class="n">lib</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
    <span class="n">print</span><span class="o">(</span><span class="s">'Loading </span><span class="si">$fileStr</span><span class="s">'</span><span class="o">);</span>
</code></pre></div></div>

<p>The audio player expects an <code class="language-plaintext highlighter-rouge">NSURL</code>, so next we use the <a href="https://developer.apple.com/documentation/foundation/nsurl/1410828-fileurlwithpath?language=objc"><code class="language-plaintext highlighter-rouge">fileURLWithPath:</code></a>
method to convert the <code class="language-plaintext highlighter-rouge">NSString</code> to an <code class="language-plaintext highlighter-rouge">NSURL</code>.
Since <code class="language-plaintext highlighter-rouge">:</code> is not a valid character in a Dart method name,
it has been translated to <code class="language-plaintext highlighter-rouge">_</code> in the bindings.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">fileUrl</span> <span class="o">=</span> <span class="n">NSURL</span><span class="o">.</span><span class="na">fileURLWithPath_</span><span class="o">(</span><span class="n">lib</span><span class="o">,</span> <span class="n">fileStr</span><span class="o">);</span>
</code></pre></div></div>

<p>Now, you can construct the <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>.
Constructing an Objective-C object has two stages.
<code class="language-plaintext highlighter-rouge">alloc</code> allocates the memory for the object,
but doesn’t initialize it.
Methods with names starting with <code class="language-plaintext highlighter-rouge">init*</code> do the initialization.
Some interfaces also provide <code class="language-plaintext highlighter-rouge">new*</code> methods that do both of these steps.</p>

<p>To initialize the <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>,
use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387281-initwithcontentsofurl?language=objc"><code class="language-plaintext highlighter-rouge">initWithContentsOfURL:error:</code></a> method:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">player</span> <span class="o">=</span>
        <span class="n">AVAudioPlayer</span><span class="o">.</span><span class="na">alloc</span><span class="o">(</span><span class="n">lib</span><span class="o">).</span><span class="na">initWithContentsOfURL_error_</span><span class="o">(</span><span class="n">fileUrl</span><span class="o">,</span> <span class="n">nullptr</span><span class="o">);</span>
</code></pre></div></div>

<p>Objective-C uses reference counting for memory management
(through retain, release, and other functions),
but on the Dart side memory management is handled automatically.
The Dart wrapper object retains a reference to the Objective-C object,
and when the Dart object is garbage collected,
the generated code automatically releases that reference using a
<a href="https://api.dart.dev/dart-ffi/NativeFinalizer-class.html"><code class="language-plaintext highlighter-rouge">NativeFinalizer</code></a>.</p>

<p>Next, look up the length of the audio file,
which you’ll need later to wait for the audio to finish.
The <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1388395-duration?language=objc"><code class="language-plaintext highlighter-rouge">duration</code></a> is a <code class="language-plaintext highlighter-rouge">@property(readonly)</code>.
Objective-C properties are translated into getters and setters
on the generated Dart wrapper object.
Since <code class="language-plaintext highlighter-rouge">duration</code> is <code class="language-plaintext highlighter-rouge">readonly</code>, only the getter is generated.</p>

<p>The resulting <code class="language-plaintext highlighter-rouge">NSTimeInterval</code> is just a type aliased <code class="language-plaintext highlighter-rouge">double</code>,
so you can immediately use the Dart <code class="language-plaintext highlighter-rouge">.ceil()</code> method
to round up to the next second:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">durationSeconds</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="na">duration</span><span class="o">.</span><span class="na">ceil</span><span class="o">();</span>
    <span class="n">print</span><span class="o">(</span><span class="s">'</span><span class="si">$durationSeconds</span><span class="s"> sec'</span><span class="o">);</span>
</code></pre></div></div>

<p>Finally, you can use the <a href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387388-play?language=objc"><code class="language-plaintext highlighter-rouge">play</code></a> method to play the audio,
then check the status, and wait for the duration of the audio file:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="n">status</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">'Playing...'</span><span class="o">);</span>
      <span class="k">await</span> <span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;.</span><span class="na">delayed</span><span class="o">(</span><span class="n">Duration</span><span class="o">(</span><span class="nl">seconds:</span> <span class="n">durationSeconds</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">print</span><span class="o">(</span><span class="s">'Failed to play audio.'</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<h3 id="callbacks-and-multithreading-limitations">
<a class="anchor" href="#callbacks-and-multithreading-limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Callbacks and multithreading limitations</h3>

<p>Multithreading issues are the biggest limitation
of Dart’s experimental support for Objective-C interop.
These limitations are due to the relationship between
Dart isolates and OS threads,
and the way Apple’s APIs handle multithreading:</p>

<ul>
  <li>Dart isolates are not the same thing as threads.
Isolates run on threads,
but aren’t guaranteed to run on any particular thread,
and the VM might change which thread an isolate is running on
without warning.
There is an <a href="https://github.com/dart-lang/sdk/issues/46943">open feature request</a> to allow isolates to be
pinned to specific threads.</li>
  <li>While <code class="language-plaintext highlighter-rouge">ffigen</code> supports converting
Dart functions to Objective-C blocks,
most Apple APIs don’t make any guarantees about
on which thread a callback will run.</li>
  <li>Most APIs that involve UI interaction
can only be called on the main thread,
also called the <em>platform</em> thread in Flutter.</li>
  <li>Many Apple APIs are <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html">not thread safe</a>.</li>
</ul>

<p>The first two points mean that a callback created in one isolate
might be invoked on a thread running a different isolate,
or no isolate at all.
This will cause your app to crash.
You can work around this limitation by writing some
Objective-C code that intercepts your callback and
forwards it over a <a href="https://api.dart.dev/dart-ffi/NativePort.html"><code class="language-plaintext highlighter-rouge">Dart_Port</code></a>
to the correct isolate.
For an example of this,
see the implementation of <a href="https://github.com/dart-lang/http/blob/master/pkgs/cupertino_http/src/CUPHTTPClientDelegate.m"><code class="language-plaintext highlighter-rouge">package:cupertino_http</code></a>.</p>

<p>The third point means that directly calling some Apple APIs
using the generated Dart bindings might be thread unsafe.
This could crash your app, or cause other unpredictable behavior.
You can work around this limitation by writing some
Objective-C code that dispatches your call
to the main thread.
For more information, see the <a href="https://developer.apple.com/documentation/dispatch?language=objc">Objective-C dispatch documentation</a>.</p>

<p>Regarding the last point,
although Dart isolates can switch threads,
they only ever run on one thread at a time.
So, the API you are interacting with
doesn’t necessarily have to be thread safe,
as long as it is not thread hostile,
and doesn’t have constraints about which thread it’s called from.</p>

<p>You can safely interact with Objective-C code,
as long as you keep these limitations in mind.</p>

<h2 id="swift-example">
<a class="anchor" href="#swift-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Swift example</h2>

<p>This <a href="https://github.com/dart-lang/ffigen/tree/master/example/swift">example</a> demonstrates how to
make a Swift class compatible with Objective-C,
generate a wrapper header, and invoke it from Dart code.</p>

<h3 id="generating-the-objective-c-wrapper-header">
<a class="anchor" href="#generating-the-objective-c-wrapper-header" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Objective-C wrapper header</h3>

<p>Swift APIs can be made compatible with Objective-C,
by using the <code class="language-plaintext highlighter-rouge">@objc</code> annotation.
Make sure to make any classes or methods you want to use
<code class="language-plaintext highlighter-rouge">public</code>, and have your classes extend <code class="language-plaintext highlighter-rouge">NSObject</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">SwiftClass</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
  <span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">func</span> <span class="nf">sayHello</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Hello from Swift!"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">@objc</span> <span class="kd">public</span> <span class="k">var</span> <span class="nv">someField</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you’re trying to interact with a third-party library,
and can’t modify their code,
you might need to write an Objective-C compatible wrapper class
that exposes the methods you want to use.</p>

<p>For more information about Objective-C / Swift interoperability,
see the <a href="https://developer.apple.com/documentation/swift/importing-swift-into-objective-c">Swift documentation</a>.</p>

<p>Once you’ve made your class compatible,
you can generate an Objective-C wrapper header.
You can do this using Xcode,
or using the Swift command-line compiler, <code class="language-plaintext highlighter-rouge">swiftc</code>.
This example uses the command line:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>swiftc <span class="nt">-c</span> swift_api.swift             <span class="se">\</span>
<span class="go">    -module-name swift_module           \
    -emit-objc-header-path swift_api.h  \
    -emit-library -o libswiftapi.dylib
</span></code></pre></div></div>

<p>This command compiles the Swift file, <code class="language-plaintext highlighter-rouge">swift_api.swift</code>,
and generates a wrapper header, <code class="language-plaintext highlighter-rouge">swift_api.h</code>.
It also generates the dylib you’re going to load later,
<code class="language-plaintext highlighter-rouge">libswiftapi.dylib</code>.</p>

<p>You can verify that the header generated correctly by opening it, 
and checking that the interfaces are what you expect.
Towards the bottom of the file,
you should see something like the following:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SWIFT_CLASS</span><span class="p">(</span><span class="s">"_TtC12swift_module10SwiftClass"</span><span class="p">)</span>
<span class="k">@interface</span> <span class="nc">SwiftClass</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span><span class="n">sayHello</span> <span class="n">SWIFT_WARN_UNUSED_RESULT</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSInteger</span> <span class="n">someField</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="n">OBJC_DESIGNATED_INITIALIZER</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div></div>

<p>If the interface is missing, or doesn’t have all its methods,
make sure they’re all annotated with <code class="language-plaintext highlighter-rouge">@objc</code> and <code class="language-plaintext highlighter-rouge">public</code>.</p>

<h3 id="configuring-ffigen-1">
<a class="anchor" href="#configuring-ffigen-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring ffigen</h3>

<p>Ffigen only sees the Objective-C wrapper header, <code class="language-plaintext highlighter-rouge">swift_api.h</code>.
So most of this config looks similar
to the Objective-C example,
including setting the language to <code class="language-plaintext highlighter-rouge">objc</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ffigen</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SwiftLibrary</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Bindings for swift_api.</span>
  <span class="na">language</span><span class="pi">:</span> <span class="s">objc</span>
  <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">swift_api_bindings.dart'</span>
  <span class="na">exclude-all-by-default</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">objc-interfaces</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">SwiftClass'</span>
    <span class="na">module</span><span class="pi">:</span>
      <span class="s1">'</span><span class="s">SwiftClass'</span><span class="err">:</span> <span class="s1">'</span><span class="s">swift_module'</span>
  <span class="na">headers</span><span class="pi">:</span>
    <span class="na">entry-points</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">swift_api.h'</span>
  <span class="na">preamble</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">// ignore_for_file: camel_case_types, non_constant_identifier_names, unused_element, unused_field, return_of_invalid_type, void_checks, annotate_overrides, no_leading_underscores_for_local_identifiers, library_private_types_in_public_api</span>
</code></pre></div></div>

<p>As before, set the language to <code class="language-plaintext highlighter-rouge">objc</code>,
and the entry point to the header;
exclude everything by default,
and explicitly include the interface you are binding.</p>

<p>One important difference between the config
for a wrapped Swift API and a pure Objective-C API:
the <code class="language-plaintext highlighter-rouge">objc-interfaces</code> -&gt; <code class="language-plaintext highlighter-rouge">module</code> option.
When <code class="language-plaintext highlighter-rouge">swiftc</code> compiles the library,
it gives the Objective-C interface a module prefix.
Internally, <code class="language-plaintext highlighter-rouge">SwiftClass</code> is actually registered as
<code class="language-plaintext highlighter-rouge">swift_module.SwiftClass</code>.
You need to tell <code class="language-plaintext highlighter-rouge">ffigen</code> about this prefix,
so it loads the correct class from the dylib.</p>

<p>Not every class gets this prefix.
For example, <code class="language-plaintext highlighter-rouge">NSString</code> and <code class="language-plaintext highlighter-rouge">NSObject</code> 
won’t get a module prefix, 
because they are internal classes.
This is why the <code class="language-plaintext highlighter-rouge">module</code> option maps
from class name to module prefix.
You can also use regular expressions to match
multiple class names at once.</p>

<p>The module prefix is whatever you passed to
<code class="language-plaintext highlighter-rouge">swiftc</code> in the <code class="language-plaintext highlighter-rouge">-module-name</code> flag.
In this example, it’s <code class="language-plaintext highlighter-rouge">swift_module</code>.
If you don’t explicitly set this flag,
it defaults to the name of the Swift file.</p>

<p>If you aren’t sure what the module name is,
you can also check the generated Objective-C header.
Above the <code class="language-plaintext highlighter-rouge">@interface</code>, you’ll find a <code class="language-plaintext highlighter-rouge">SWIFT_CLASS</code> macro:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SWIFT_CLASS</span><span class="p">(</span><span class="s">"_TtC12swift_module10SwiftClass"</span><span class="p">)</span>
<span class="k">@interface</span> <span class="nc">SwiftClass</span> <span class="p">:</span> <span class="nc">NSObject</span>
</code></pre></div></div>

<p>The string inside the macro is a bit cryptic, but you can
see it contains the module name and the class name:
<code class="language-plaintext highlighter-rouge">"_TtC12</code><strong><em><code class="language-plaintext highlighter-rouge">swift_module</code></em></strong><code class="language-plaintext highlighter-rouge">10</code><strong><em><code class="language-plaintext highlighter-rouge">SwiftClass</code></em></strong><code class="language-plaintext highlighter-rouge">"</code>.</p>

<p>Swift can even demangle this name for us:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"_TtC12swift_module10SwiftClass"</span> | swift demangle
</code></pre></div></div>

<p>This outputs <code class="language-plaintext highlighter-rouge">swift_module.SwiftClass</code>.</p>

<h3 id="generating-the-dart-bindings-1">
<a class="anchor" href="#generating-the-dart-bindings-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating the Dart bindings</h3>

<p>As before, navigate to the example directory,
and run ffigen:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run ffigen
</code></pre></div></div>

<p>This generates <code class="language-plaintext highlighter-rouge">swift_api_bindings.dart</code>.</p>

<h3 id="using-the-bindings-1">
<a class="anchor" href="#using-the-bindings-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the bindings</h3>

<p>Interacting with these bindings is exactly the same
as for a normal Objective-C library:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'dart:ffi'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'swift_api_bindings.dart'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">SwiftLibrary</span><span class="o">(</span><span class="n">DynamicLibrary</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">'libswiftapi.dylib'</span><span class="o">));</span>
  <span class="kd">final</span> <span class="n">object</span> <span class="o">=</span> <span class="n">SwiftClass</span><span class="o">.</span><span class="na">new1</span><span class="o">(</span><span class="n">lib</span><span class="o">);</span>
  <span class="n">print</span><span class="o">(</span><span class="n">object</span><span class="o">.</span><span class="na">sayHello</span><span class="o">());</span>
  <span class="n">print</span><span class="o">(</span><span class="s">'field = </span><span class="si">${object.someField}</span><span class="s">'</span><span class="o">);</span>
  <span class="n">object</span><span class="o">.</span><span class="na">someField</span> <span class="o">=</span> <span class="mi">456</span><span class="o">;</span>
  <span class="n">print</span><span class="o">(</span><span class="s">'field = </span><span class="si">${object.someField}</span><span class="s">'</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that the module name is not mentioned
in the generated Dart API.
It’s only used internally,
to load the class from the dylib.</p>

<p>Now you can run the example using:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>dart run example.dart
</code></pre></div></div>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
  <div class="footer-section footer-main">
    <a href="/" class="brand" title="Dart">
      <img src="/assets/img/shared/dart/logo+text/horizontal/white.svg" alt="Dart" width="164px">
    </a>
    <div class="footer-social-links">
      <a href="https://medium.com/dartlang" target="_blank" rel="noopener" title="Medium blog" class="no-automatic-external">
        <svg>
          <use href="/assets/img/social/medium.svg#medium"></use>
        </svg>
      </a>
      <a href="https://github.com/dart-lang" target="_blank" rel="noopener" title="GitHub" class="no-automatic-external">
        <svg>
          <use href="/assets/img/social/github.svg#github"></use>
        </svg>
      </a>
      <a href="https://twitter.com/dart_lang" target="_blank" rel="noopener" title="Twitter" class="no-automatic-external">
        <svg>
          <use href="/assets/img/social/twitter.svg#twitter"></use>
        </svg>
      </a>
    </div>
  </div>
  <div class="footer-section footer-tray">
    <div class="footer-licenses">
      Salvo que se indique lo contrario, este sitio está bajo una 
      <a href="https://creativecommons.org/licenses/by/4.0/" class="no-automatic-external">licencia internacional Creative Commons Attribution 4.0</a >, 
      y los ejemplos de código tienen licencia 
      <a href="https://opensource.org/licenses/BSD-3-Clause" class="no-automatic-external">3-Clause BSD License</a>.
    </div>
    <div class="footer-utility-links">
      <ul>
        <li><a href="/terms" title="Terms of use">Términos</a></li>
        <li><a href="https://policies.google.com/privacy" target="_blank" rel="noopener" title="Privacy policy" class="no-automatic-external">Privacidad</a></li>
        <li><a href="/security" title="Security philosophy and practices">Seguridad</a></li>
      </ul>
    </div>
  </div>
</footer>

   
  </body>
</html>
